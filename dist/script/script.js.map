{"version":3,"sources":["santa-battle.js"],"names":["santaBattle","opts","loadViewTarget","loadView","player","level","pieces","html","$","init","prototype","buildPiece","obj","piece","id","class","type","bindControls","document","addEventListener","idKey","bind","e","keyCode","keyUp","keyDown","keyLeft","keyRight","movePlayer","dir","top","left","scrollHeight","target","setPlayerPos","loadPlayer","append","css","selectPiece","weightSum","i","length","weight","index","Math","floor","random","j","loadPiece","pieceSetup","pieceLoadView","pieceTarget","removeFn","topPos","clientHeight","leftPos","clientWidth","anim","_","pieceAnim","setInterval","animLeft","offsetLeft","remove","clearInterval","initPieces","loadedPieces","count","push","removeLoadedPiece","splice","initCollisionWatch","collisionWatch","collisionTest","identifyPiecePositions","positionData","closePieces","getClosePieces","result","identifyCollision","console","log","y","height","x","width","array","pos","getBoundingClientRect","off","on","startGame","game","points","chimney"],"mappings":"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","file":"script.js","sourcesContent":["var santaBattle = function(opts){\r\n\r\n\tthis.opts = {};\r\n\r\n\tthis.opts.loadViewTarget = opts.loadView || false;\r\n\tthis.opts.player = opts.player || false;\r\n\tthis.opts.level = opts.level || 1;\r\n\tthis.opts.pieces = opts.pieces;\r\n\tthis.html = opts.html;\r\n\r\n\tif(this.opts.loadViewTarget && this.opts.player){\r\n\t\tthis.loadView = $(this.opts.loadViewTarget);\r\n\t\tthis.init();\r\n\t};\r\n};\r\n\r\n/* Services */\r\n\r\nsantaBattle.prototype.buildPiece = function(obj){\r\n\tvar piece = '<div';\r\n\tif(obj.id)piece += ' id=\"' + obj.id + '\"';\r\n\tif(obj.class)piece += ' class=\"' + obj.class + '\"';\r\n\tif(obj.type)piece += ' data-type=\"' + obj.type + '\"';\r\n\tpiece += '></div>';\r\n\treturn piece;\r\n};\r\n\r\n/* Controls */\r\n\r\nsantaBattle.prototype.bindControls = function(){\r\n\tdocument.addEventListener(\"keydown\", this.idKey.bind(this), false);\r\n};\r\n\r\nsantaBattle.prototype.idKey = function(e){\r\n\tswitch(e.keyCode){\r\n\t\tcase 38: // arrow up\r\n\t\tcase 87: // w\r\n\t\t\tthis.keyUp();\r\n\t\tbreak;\r\n\t\tcase 40: // down\r\n\t\tcase 83: // s\r\n\t\t\tthis.keyDown();\r\n\t\tbreak;\r\n\t\tcase 37: // left\r\n\t\tcase 65: // a\r\n\t\t\tthis.keyLeft();\r\n\t\tbreak;\r\n\t\tcase 39: // right\r\n\t\tcase 68: // d\r\n\t\t\tthis.keyRight();\r\n\t\tbreak;\r\n\t\tcase 32: // space\r\n\r\n\t\tbreak;\r\n\t};\r\n};\r\n\r\n/* Player Actions */\r\n\r\nsantaBattle.prototype.keyUp = function(){\r\n\tthis.movePlayer('up');\r\n};\r\n\r\nsantaBattle.prototype.keyDown = function(){\r\n\tthis.movePlayer('down');\r\n};\r\n\r\nsantaBattle.prototype.keyLeft = function(){\r\n\tthis.movePlayer('left');\r\n};\r\n\r\nsantaBattle.prototype.keyRight = function(){\r\n\tthis.movePlayer('right');\r\n};\r\n\r\nsantaBattle.prototype.movePlayer = function(dir){\r\n\tswitch(dir){\r\n\t\tcase 'up':\r\n\t\t\tthis.player.top -= 20;\r\n\t\tbreak;\r\n\t\tcase 'down':\r\n\t\t\tthis.player.top += 20;\r\n\t\tbreak;\r\n\t\tcase 'left':\r\n\t\t\tthis.player.left -= 20;\r\n\t\tbreak;\r\n\t\tcase 'right':\r\n\t\t\tthis.player.left += 20;\r\n\t\tbreak;\r\n\t}\r\n\r\n\tif(this.player.top < 0) this.player.top = 0;\r\n\tif(this.player.left < 0) this.player.left = 0;\r\n\r\n\tif(this.player.top > (this.loadView[0].scrollHeight - this.player.target[0].scrollHeight)) this.player.top = this.loadView[0].scrollHeight - this.player.target[0].scrollHeight;\r\n\r\n\tthis.setPlayerPos();\r\n};\r\n\r\nsantaBattle.prototype.loadPlayer = function(){\r\n\tvar html = this.buildPiece(this.opts.player);\r\n\tthis.loadView.append(html);\r\n\tthis.player = {\r\n\t\ttarget:$('#' + this.opts.player.id),\r\n\t\ttop:300,\r\n\t\tleft:0\r\n\t};\r\n\tthis.setPlayerPos();\r\n};\r\n\r\nsantaBattle.prototype.setPlayerPos = function(top, left){\r\n\tthis.player.target.css({\r\n\t\ttop:this.player.top + 'px',\r\n\t\tleft:this.player.left + 'px'\r\n\t});\r\n};\r\n\r\n/* Loading Pieces */\r\n\r\nsantaBattle.prototype.selectPiece = function (){\r\n\t// add up all the weights\r\n\tvar weightSum = 0;\r\n\tfor(var i = 0; i < this.opts.pieces.length; i++){\r\n\t\tweightSum+= this.opts.pieces[i].weight;\r\n\t};\r\n\r\n\twhile(weightSum > 0){\r\n\r\n\t\t// select random piece index\r\n\r\n\t\tvar index = Math.floor(Math.random() * Math.floor(this.opts.pieces.length - 1));\r\n\r\n\t\t// select random piece index\r\n\r\n\t\tweightSum -= this.opts.pieces[index].weight;\r\n\r\n\t\tif(weightSum > 0){\r\n\t\t\tfor(var j = 0; j < this.opts.pieces.length; j++){\r\n\t\t\t\tif(this.opts.pieces[j].weight === weightSum){\r\n\t\t\t\t\treturn this.opts.pieces[j];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn false;\r\n};\r\n\r\nsantaBattle.prototype.loadPiece = function (obj){\r\n\tvar html = this.buildPiece(obj);\r\n\tthis.loadView.append(html);\r\n};\r\n\r\n/* Piece setup functions (new instance required) */\r\n\r\nsantaBattle.prototype.pieceSetup = function(opts){\r\n\r\n\tthis.piece = opts.piece;\r\n\tthis.pieceLoadView = opts.loadView;\r\n\tthis.pieceTarget = $('#' + this.piece.id);\r\n\tthis.removeFn = opts.removeFn;\r\n\r\n\tvar topPos = Math.floor(Math.random() * Math.floor(this.pieceLoadView[0].clientHeight - this.pieceTarget[0].clientHeight)),\r\n\t\tleftPos = this.pieceLoadView[0].clientWidth - this.pieceTarget[0].clientWidth;\r\n\r\n\tthis.pieceTarget.css({\r\n\t\ttop: topPos + \"px\",\r\n\t\tleft: leftPos + \"px\"\r\n\t});\r\n\r\n\tthis.anim();\r\n};\r\n\r\nsantaBattle.prototype.pieceSetup.prototype.anim = function(){\r\n\tvar _ = this;\r\n\tthis.pieceAnim = setInterval(_.animLeft.bind(_),500);\r\n};\r\n\r\nsantaBattle.prototype.pieceSetup.prototype.animLeft = function(){\r\n\tthis.pieceTarget.css({\r\n\t\tleft: this.pieceTarget[0].offsetLeft - 10 + \"px\"\r\n\t});\r\n\r\n\tif(this.pieceTarget[0].offsetLeft <= -this.pieceTarget[0].clientWidth){\r\n\t\tthis.pieceTarget[0].remove();\r\n\t\tthis.removeFn(this.piece.id);\r\n\t\tclearInterval(this.pieceAnim);\r\n\r\n\t};\r\n};\r\n\r\n/**************************************************/\r\n\r\nsantaBattle.prototype.initPieces = function (){\r\n\tthis.loadedPieces = [];\r\n\tvar count = 0;\r\n\r\n\tvar _ = this;\r\n\r\n\tsetInterval(function(){\r\n\t\tvar piece = _.selectPiece();\r\n\t\tif(piece){\r\n\t\t\tcount += 1;\r\n\t\t\tpiece.id = 'piece' + count;\r\n\t\t\t_.loadPiece(piece);\r\n\t\t\t_.loadedPieces.push(piece);\r\n\t\t\t\r\n\t\t\t// Create new instance for piece setup and animations\r\n\t\t\tthis[\"activePiece\" + piece.id] = new _.pieceSetup({\r\n\t\t\t\tpiece:piece,\r\n\t\t\t\tloadView: _.loadView,\r\n\t\t\t\tremoveFn: _.removeLoadedPiece.bind(_)\r\n\t\t\t});\r\n\t\t};\r\n\t}, 2000); // random interval depending on level\r\n};\r\n\r\nsantaBattle.prototype.removeLoadedPiece = function (id){\r\n\tfor(var i = 0; i < this.loadedPieces.length; i++){\r\n\t\tif(this.loadedPieces[i].id === id){\r\n\t\t\tthis.loadedPieces.splice(i,1);\r\n\t\t\treturn;\r\n\t\t};\r\n\t};\r\n};\r\n\r\n\r\nsantaBattle.prototype.initCollisionWatch = function(){\r\n\tvar _ = this;\r\n\tthis.collisionWatch = setInterval(_.collisionTest.bind(_),500);\r\n};\r\n\r\n\r\nsantaBattle.prototype.collisionTest = function(){\r\n\tthis.identifyPiecePositions();\r\n\tthis.positionData(this.opts.player);\r\n\tthis.closePieces = this.getClosePieces();\r\n\tthis.result = this.identifyCollision();\r\n\tconsole.log(this.result);\r\n};\r\n\r\nsantaBattle.prototype.identifyCollision = function(){\r\n\tfor(var i = 0; i < this.closePieces.length; i++){\r\n\t\tvar piece = this.closePieces[i];\r\n\t\tif(piece.y > this.opts.player.y && \r\n\t\tpiece.y + piece.height < this.opts.player.y + this.opts.player.height &&\r\n\t\tpiece.x < this.opts.player.x + this.opts.player.width &&\r\n\t\tpiece.x + piece.width < this.opts.player.x\r\n\t\t){\r\n\t\t\treturn piece;\r\n\t\t};\r\n\t};\r\n\treturn false;\r\n};\r\n\r\nsantaBattle.prototype.getClosePieces = function(){\r\n\tvar array = [];\r\n\r\n\tfor(var i = 0; i < this.loadedPieces.length; i++){\r\n\t\tif(this.loadedPieces[i].x < this.opts.player.x + this.opts.player.width + 10){\r\n\t\t\tvar obj = {\r\n\t\t\t\tid: this.loadedPieces[i].id,\r\n\t\t\t\twidth:this.loadedPieces[i].width,\r\n\t\t\t\theight:this.loadedPieces[i].height,\r\n\t\t\t\tx:this.loadedPieces[i].x,\r\n\t\t\t\ty:this.loadedPieces[i].y\r\n\t\t\t};\r\n\t\t\tarray.push(obj);\r\n\t\t};\r\n\t};\r\n\treturn array;\r\n};\r\n\r\nsantaBattle.prototype.identifyPiecePositions = function(){\r\n\tfor(var i = 0; i < this.loadedPieces.length; i++){\r\n\t\tthis.positionData(this.loadedPieces[i]);\r\n\t};\r\n};\r\n\r\nsantaBattle.prototype.positionData = function(obj){\r\n\tvar target = $(\"#\" + obj.id),\r\n\t\tpos = target[0].getBoundingClientRect();\r\n\tobj.width = target[0].clientWidth;\r\n\tobj.height = target[0].clientHeight;\r\n\tobj.y = Math.floor(pos.top);\r\n\tobj.x = Math.floor(pos.left);\r\n};\r\n\r\n\r\n/* Init functions */\r\n\r\nsantaBattle.prototype.init = function(){\r\n\tvar _ = this;\r\n\t$('#startGame').off('click').on('click', function(){\r\n\t\t_.startGame();\r\n\t});\r\n};\r\n\r\nsantaBattle.prototype.startGame = function(){\r\n\tthis.bindControls();\r\n\tthis.loadPlayer();\r\n\tthis.initPieces();\r\n\tthis.initCollisionWatch();\r\n};\r\n\r\n(function(){\r\n\r\n\t$(function(){\r\n\t\tconst game = new santaBattle({\r\n\t\t\tloadView:'#santaBattle',\r\n\t\t\tplayer: {\r\n\t\t\t\tid:'player1',\r\n\t\t\t\tclass:'c-santa'\r\n\t\t\t},\r\n\t\t\tlevel:1,\r\n\t\t\tpieces:[\r\n\t\t\t\t{\r\n\t\t\t\t\tclass:\"c-piece c-piece--present\",\r\n\t\t\t\t\tpoints:10,\r\n\t\t\t\t\ttype:\"collectable\",\r\n\t\t\t\t\tweight:5\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tclass:\"c-piece c-piece--bonus\",\r\n\t\t\t\t\tpoints:50,\r\n\t\t\t\t\ttype:\"collectable\",\r\n\t\t\t\t\tweight:1\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tclass:\"c-piece c-piece--old-boot\",\r\n\t\t\t\t\ttype:\"baddie\",\r\n\t\t\t\t\tweight:3\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tclass:\"c-piece c-piece--evil-elf\",\r\n\t\t\t\t\ttype:\"baddie\",\r\n\t\t\t\t\tweight:4\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\tchimney:{\r\n\t\t\t\tclass:\"c-chimney\",\r\n\t\t\t\ttype:\"catcher\",\r\n\t\t\t\tweight:2,\r\n\t\t\t\tpoints:30\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n})();"]}